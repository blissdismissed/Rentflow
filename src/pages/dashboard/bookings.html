<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookings - A&A RentFlow</title>
    <script>
        // Auth protection
        if (!localStorage.getItem('token')) {
            window.location.href = '/src/pages/auth/login.html';
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .booking-card { transition: all 0.3s ease; }
        .booking-card:hover { transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1); }
        .platform-badge-airbnb { background-color: #FF5A5F; color: white; }
        .platform-badge-vrbo { background-color: #0D47A1; color: white; }
        .platform-badge-direct { background-color: #10B981; color: white; }
        .status-confirmed { background-color: #10B981; }
        .status-pending { background-color: #F59E0B; }
        .status-cancelled { background-color: #6B7280; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen" data-page="bookings">
    <!-- Header Component -->
    <div id="header-placeholder"></div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="flex justify-between items-center mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Bookings</h1>
                <p class="text-gray-600">Manage all your reservations from Airbnb, VRBO, and direct bookings</p>
            </div>
            <button onclick="openCreateBookingModal()" class="bg-teal-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-teal-700 transition-colors">
                + Create Direct Booking
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Total Bookings</p>
                        <p class="text-2xl font-bold text-gray-900" id="stat-total">0</p>
                    </div>
                    <div class="h-12 w-12 bg-teal-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Confirmed</p>
                        <p class="text-2xl font-bold text-green-600" id="stat-confirmed">0</p>
                    </div>
                    <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Total Revenue</p>
                        <p class="text-2xl font-bold text-gray-900" id="stat-revenue">$0</p>
                    </div>
                    <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">Direct Bookings</p>
                        <p class="text-2xl font-bold text-gray-900" id="stat-direct">0</p>
                    </div>
                    <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
            <div class="grid md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                    <select id="filter-status" onchange="filterBookings()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                        <option value="">All Statuses</option>
                        <option value="requested">Pending Approval</option>
                        <option value="confirmed">Confirmed</option>
                        <option value="pending">Pending</option>
                        <option value="cancelled">Cancelled</option>
                        <option value="checked_in">Checked In</option>
                        <option value="checked_out">Checked Out</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Platform</label>
                    <select id="filter-platform" onchange="filterBookings()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                        <option value="">All Platforms</option>
                        <option value="direct">Direct</option>
                        <option value="airbnb">Airbnb</option>
                        <option value="vrbo">VRBO</option>
                        <option value="booking_com">Booking.com</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
                    <input type="date" id="filter-start-date" onchange="filterBookings()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
                    <input type="date" id="filter-end-date" onchange="filterBookings()" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                </div>
            </div>
        </div>

        <!-- Bookings List -->
        <div id="bookings-container" class="space-y-4">
            <!-- Bookings will be loaded here -->
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
            <svg class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <h3 class="text-lg font-medium text-gray-900 mb-2">No bookings found</h3>
            <p class="text-gray-600 mb-6">Get started by creating a direct booking or connecting your Airbnb account</p>
            <div class="flex gap-4 justify-center">
                <button onclick="openCreateBookingModal()" class="bg-teal-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-teal-700">
                    Create Direct Booking
                </button>
                <a href="/src/pages/dashboard/integrations.html" class="bg-white text-gray-700 px-6 py-2 rounded-lg font-medium border border-gray-300 hover:bg-gray-50">
                    Connect Airbnb
                </a>
            </div>
        </div>
    </div>

    <!-- Decline Modal -->
    <div id="decline-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-md w-full">
            <div class="p-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Decline Booking Request</h3>
                <p class="text-gray-600 mb-4">Please provide a reason for declining this booking:</p>
                <textarea id="decline-reason" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500" placeholder="Enter reason..."></textarea>
                <div class="flex gap-3 mt-4">
                    <button onclick="confirmDecline()" class="flex-1 bg-red-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-red-700">
                        Decline Booking
                    </button>
                    <button onclick="closeDeclineModal()" class="flex-1 bg-gray-100 text-gray-700 px-6 py-2 rounded-lg font-medium hover:bg-gray-200">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Booking Modal -->
    <div id="create-booking-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-2xl font-bold text-gray-900">Create Direct Booking</h2>
                    <button onclick="closeCreateBookingModal()" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <form id="create-booking-form" class="p-6 space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Property *</label>
                    <select name="propertyId" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                        <option value="">Select a property</option>
                    </select>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Guest Name *</label>
                        <input type="text" name="guestName" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Guest Email *</label>
                        <input type="email" name="guestEmail" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Guest Phone</label>
                        <input type="tel" name="guestPhone" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Guests *</label>
                        <input type="number" name="numberOfGuests" required min="1" value="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Check-in Date *</label>
                        <input type="date" name="checkIn" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Check-out Date *</label>
                        <input type="date" name="checkOut" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Total Amount *</label>
                    <div class="relative">
                        <span class="absolute left-3 top-2 text-gray-500">$</span>
                        <input type="number" name="totalAmount" required min="0" step="0.01" class="w-full pl-8 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Special Requests</label>
                    <textarea name="specialRequests" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-teal-500 focus:border-teal-500"></textarea>
                </div>

                <div class="flex gap-3 pt-4">
                    <button type="submit" class="flex-1 bg-teal-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-teal-700">
                        Create Booking
                    </button>
                    <button type="button" onclick="closeCreateBookingModal()" class="flex-1 bg-gray-100 text-gray-700 px-6 py-3 rounded-lg font-medium hover:bg-gray-200">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer Component -->
    <div id="footer-placeholder"></div>

    <script src="/src/components/component-loader.js"></script>
    <script>
        window.isDashboardPage = true;
        loadHeaderFooter('dashboard');

        const API_URL = 'http://localhost:5000/api';
        let allBookings = [];
        let userProperties = [];

        // Load data on page load
        async function init() {
            await loadProperties();
            await loadBookings();
            await loadStats();
        }

        async function loadProperties() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/properties`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const { data } = await response.json();
                    userProperties = data;

                    // Populate property dropdown
                    const select = document.querySelector('select[name="propertyId"]');
                    data.forEach(property => {
                        const option = document.createElement('option');
                        option.value = property.id;
                        option.textContent = property.name;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('Error loading properties:', error);
            }
        }

        async function loadBookings() {
            try {
                const token = localStorage.getItem('token');
                const params = new URLSearchParams();

                const status = document.getElementById('filter-status').value;
                const platform = document.getElementById('filter-platform').value;
                const startDate = document.getElementById('filter-start-date').value;
                const endDate = document.getElementById('filter-end-date').value;

                if (status) params.append('status', status);
                if (platform) params.append('platform', platform);
                if (startDate) params.append('startDate', startDate);
                if (endDate) params.append('endDate', endDate);

                const response = await fetch(`${API_URL}/bookings?${params}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const { data } = await response.json();
                    allBookings = data;
                    renderBookings(data);
                }
            } catch (error) {
                console.error('Error loading bookings:', error);
            }
        }

        async function loadStats() {
            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/bookings/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const { data } = await response.json();
                    document.getElementById('stat-total').textContent = data.totalBookings || 0;
                    document.getElementById('stat-confirmed').textContent = data.confirmedBookings || 0;
                    document.getElementById('stat-revenue').textContent = `$${(data.totalRevenue || 0).toLocaleString()}`;

                    const directCount = data.platformBreakdown?.find(p => p.platform === 'direct')?.count || 0;
                    document.getElementById('stat-direct').textContent = directCount;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        function renderBookings(bookings) {
            const container = document.getElementById('bookings-container');
            const emptyState = document.getElementById('empty-state');

            if (bookings.length === 0) {
                container.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            emptyState.classList.add('hidden');

            container.innerHTML = bookings.map(booking => {
                const checkIn = new Date(booking.checkIn).toLocaleDateString();
                const checkOut = new Date(booking.checkOut).toLocaleDateString();
                const platform = booking.platform || 'direct';
                const nights = Math.ceil((new Date(booking.checkOut) - new Date(booking.checkIn)) / (1000 * 60 * 60 * 24));
                const bookingStatus = booking.bookingStatus || booking.status;
                const isAwaitingApproval = bookingStatus === 'requested';

                return `
                    <div class="booking-card bg-white rounded-lg shadow-sm border ${isAwaitingApproval ? 'border-yellow-300 bg-yellow-50' : 'border-gray-200'} p-6">
                        ${isAwaitingApproval ? '<div class="bg-yellow-100 border border-yellow-300 text-yellow-800 px-3 py-2 rounded-lg mb-4 flex items-center"><svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path></svg><strong>Awaiting Your Approval</strong> - Guest is waiting for your response</div>' : ''}
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-2">
                                    <h3 class="text-lg font-semibold text-gray-900">${booking.guestName}</h3>
                                    <span class="platform-badge-${platform} text-xs px-2 py-1 rounded-full font-medium uppercase">
                                        ${platform}
                                    </span>
                                    <span class="status-${booking.status} text-white text-xs px-2 py-1 rounded-full font-medium">
                                        ${bookingStatus}
                                    </span>
                                </div>
                                <p class="text-gray-600 mb-3">${booking.Property?.name || 'Property'}</p>
                                <div class="flex flex-wrap gap-4 text-sm text-gray-600 mb-3">
                                    <div class="flex items-center">
                                        <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                                        </svg>
                                        ${checkIn} - ${checkOut} (${nights} nights)
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        ${booking.numberOfGuests} guests
                                    </div>
                                    <div class="flex items-center">
                                        <svg class="h-4 w-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                        </svg>
                                        ${booking.guestEmail}
                                    </div>
                                </div>
                                ${booking.guestMessage ? `<div class="bg-gray-100 rounded-lg p-3 text-sm text-gray-700 mb-3"><strong>Guest Message:</strong> ${booking.guestMessage}</div>` : ''}
                                ${booking.depositAmount ? `
                                    <div class="text-sm text-gray-600">
                                        <span class="font-semibold">Payment:</span>
                                        $${booking.depositAmount} deposit (10%)
                                        ${booking.depositPaid ? '<span class="text-green-600">✓ Paid</span>' : '<span class="text-yellow-600">• Pending approval</span>'}
                                        / $${booking.balanceAmount} balance due at check-in
                                    </div>
                                ` : ''}
                            </div>
                            <div class="text-right ml-6">
                                <p class="text-2xl font-bold text-gray-900 mb-2">$${booking.totalAmount.toLocaleString()}</p>
                                ${booking.confirmationCode ? `<p class="text-xs text-gray-500 mb-3">Code: ${booking.confirmationCode}</p>` : ''}
                                ${isAwaitingApproval ? `
                                    <div class="flex flex-col gap-2">
                                        <button onclick="approveBooking('${booking.id}')" class="bg-green-600 text-white px-6 py-2 rounded-lg text-sm font-semibold hover:bg-green-700 transition">
                                            ✓ Approve & Charge Deposit
                                        </button>
                                        <button onclick="openDeclineModal('${booking.id}')" class="bg-red-600 text-white px-6 py-2 rounded-lg text-sm font-semibold hover:bg-red-700 transition">
                                            ✗ Decline
                                        </button>
                                    </div>
                                ` : platform === 'direct' && booking.status !== 'cancelled' ? `
                                    <button onclick="cancelBooking('${booking.id}')" class="text-red-600 hover:text-red-700 text-sm font-medium">
                                        Cancel Booking
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function filterBookings() {
            loadBookings();
        }

        function openCreateBookingModal() {
            document.getElementById('create-booking-modal').classList.remove('hidden');
        }

        function closeCreateBookingModal() {
            document.getElementById('create-booking-modal').classList.add('hidden');
            document.getElementById('create-booking-form').reset();
        }

        document.getElementById('create-booking-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData);

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/bookings`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    closeCreateBookingModal();
                    alert('Booking created successfully!');
                    await loadBookings();
                    await loadStats();
                } else {
                    const error = await response.json();
                    alert(error.message || 'Failed to create booking');
                }
            } catch (error) {
                console.error('Error creating booking:', error);
                alert('Error creating booking');
            }
        });

        async function cancelBooking(bookingId) {
            if (!confirm('Are you sure you want to cancel this booking?')) return;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/bookings/${bookingId}/cancel`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        cancellationReason: 'Cancelled by host'
                    })
                });

                if (response.ok) {
                    alert('Booking cancelled successfully');
                    await loadBookings();
                    await loadStats();
                } else {
                    const error = await response.json();
                    alert(error.message || 'Failed to cancel booking');
                }
            } catch (error) {
                console.error('Error cancelling booking:', error);
                alert('Error cancelling booking');
            }
        }

        // Approve booking
        async function approveBooking(bookingId) {
            if (!confirm('Are you sure you want to approve this booking? The guest\'s card will be charged for the deposit.')) return;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/bookings/${bookingId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Booking approved successfully! Guest has been notified and deposit charged.');
                    await loadBookings();
                    await loadStats();
                } else {
                    alert(result.message || 'Failed to approve booking');
                }
            } catch (error) {
                console.error('Error approving booking:', error);
                alert('Error approving booking');
            }
        }

        // Decline booking modal
        let declineBookingId = null;

        function openDeclineModal(bookingId) {
            declineBookingId = bookingId;
            document.getElementById('decline-modal').classList.remove('hidden');
        }

        function closeDeclineModal() {
            declineBookingId = null;
            document.getElementById('decline-reason').value = '';
            document.getElementById('decline-modal').classList.add('hidden');
        }

        async function confirmDecline() {
            const reason = document.getElementById('decline-reason').value;

            if (!reason.trim()) {
                alert('Please provide a reason for declining');
                return;
            }

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_URL}/bookings/${declineBookingId}/decline`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Booking declined successfully. Guest has been notified and no charge was made.');
                    closeDeclineModal();
                    await loadBookings();
                    await loadStats();
                } else {
                    alert(result.message || 'Failed to decline booking');
                }
            } catch (error) {
                console.error('Error declining booking:', error);
                alert('Error declining booking');
            }
        }

        // Initialize
        init();
    </script>
    <script src="/public/js/main.js"></script>
</body>
</html>
